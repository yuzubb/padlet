<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Padlet Full Monitor</title>
    <style>
        :root { --p-pink: #ff4b2b; --p-bg: #f4f7f6; }
        body { font-family: -apple-system, sans-serif; background: var(--p-bg); margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .post { background: white; border-radius: 15px; margin-bottom: 25px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.05); border: 1px solid #ddd; }
        .post-header { padding: 15px 20px; background: #fafafa; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .author-info { display: flex; flex-direction: column; }
        .author-name { font-weight: bold; color: var(--p-pink); font-size: 1.1em; }
        .pub-date { font-size: 0.8em; color: #888; margin-top: 4px; }
        .post-body { padding: 20px; }
        .post-title { font-size: 1.4em; font-weight: 800; margin-bottom: 15px; color: #222; }
        .post-content { line-height: 1.6; color: #333; }
        /* Padletç‹¬è‡ªã®åŸ‹ã‚è¾¼ã¿ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
        .post-content img, .post-content iframe { max-width: 100%; border-radius: 10px; margin-top: 10px; }
        .post-footer { padding: 10px 20px; background: #fdfdfd; font-size: 0.8em; border-top: 1px dashed #eee; display: flex; gap: 15px; }
        .post-footer a { color: #007bff; text-decoration: none; }
        .guid { color: #ccc; font-family: monospace; }
        #status { position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.7); color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; }
    </style>
</head>
<body>
    <div id="status">Syncing...</div>
    <div class="container" id="board"></div>

    <script>
        let lastId = "";
        async function fetchPosts() {
            try {
                const res = await fetch('/api/index');
                const data = await res.json();
                if (data.length === 0) return;
                
                // æœ€åˆã®æŠ•ç¨¿ã®GUIDã§å¤‰æ›´ãƒã‚§ãƒƒã‚¯
                if (data[0].guid === lastId) return;
                lastId = data[0].guid;

                document.getElementById('board').innerHTML = data.map(p => `
                    <div class="post">
                        <div class="post-header">
                            <div class="author-info">
                                <span class="author-name">ğŸ‘¤ ${p.author || 'Anonymous'}</span>
                                <span class="pub-date">ğŸ“… ${p.pubDate}</span>
                            </div>
                            <a href="${p.link}" target="_blank">ğŸ”— View Original</a>
                        </div>
                        <div class="post-body">
                            ${p.title ? `<div class="post-title">${p.title}</div>` : ''}
                            <div class="post-content">${p.description}</div>
                        </div>
                        <div class="post-footer">
                            <span class="guid">ID: ${p.guid}</span>
                            <a href="${p.source}" target="_blank">ğŸ“ Source Board</a>
                        </div>
                    </div>
                `).join('');
                document.getElementById('status').innerText = "Last Updated: " + new Date().toLocaleTimeString();
            } catch (e) {
                document.getElementById('status').innerText = "Error fetching data";
            }
        }

        setInterval(fetchPosts, 2000); // 2ç§’é–“éš”ã§æ›´æ–°
        fetchPosts();
    </script>
</body>
</html>

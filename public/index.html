<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Padlet Monitor</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; }
        .post { background: white; border-radius: 8px; padding: 15px; margin-bottom: 15px; shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header { display: flex; align-items: center; margin-bottom: 10px; }
        .icon { width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; background: #eee; }
        .user { font-weight: bold; color: #1c1e21; }
        .time { font-size: 0.8em; color: #65676b; margin-left: 10px; }
        .title { font-size: 1.1em; margin: 10px 0; font-weight: bold; }
        .content { font-size: 0.95em; color: #333; line-height: 1.4; }
        #status { position: fixed; top: 10px; right: 10px; font-size: 12px; color: green; }
    </style>
</head>
<body>
    <div id="status">監視中 (1s間隔)</div>
    <div id="board">読み込み中...</div>

    <script>
        let lastDataHash = "";

        async function updateBoard() {
            try {
                const res = await fetch('/api/index');
                const posts = await res.json();
                
                // 簡易的な差分チェック（件数と最初のIDで判定）
                const currentHash = posts.length > 0 ? posts[0].id + posts.length : "";
                if (currentHash === lastDataHash) return; 
                lastDataHash = currentHash;

                const board = document.getElementById('board');
                board.innerHTML = posts.map(post => `
                    <div class="post">
                        <div class="header">
                            <img src="${post.author_icon}" class="icon" onerror="this.src='https://padlet.com/favicon.ico'">
                            <span class="user">${post.author}</span>
                            <span class="time">${new Date(post.updated).toLocaleString()}</span>
                        </div>
                        <div class="title">${post.title}</div>
                        <div class="content">${post.content}</div>
                    </div>
                `).join('');
            } catch (e) {
                console.error("更新失敗", e);
            }
        }

        // 1秒ごとに実行
        setInterval(updateBoard, 1000);
        updateBoard();
    </script>
</body>
</html>
